{"version":3,"file":"vue.js","sources":["../src/utils.js","../src/obsever/array.js","../src/obsever/index.js","../src/state.js","../src/compiler/parser.js","../src/compiler/generate.js","../src/compiler/index.js","../src/obsever/watcher.js","../src/lifecycle.js","../src/init.js","../src/vdom/create-element.js","../src/render.js","../src/index.js"],"sourcesContent":["// 工具方法\nexport function isObject(obj) {\n  return typeof obj === \"object\" && obj !== null;\n}\n","let oldArrayMethods = Array.prototype;\n\nexport let arrayMethods = Object.create(oldArrayMethods);\n\nconst methods = [\"push\", \"shift\", \"unshift\", \"sort\", \"reverse\", \"splice\"];\nmethods.forEach((method) => {\n  arrayMethods[method] = function (...args) {\n    // 获取到当前调用方法上的ob\n    const ob = this.__ob__;\n    // 这里的this指向的是调用函数劫持后修改的数组 也就是调用arrMethods[method]的数组\n    const result = oldArrayMethods[method].apply(this, args); // 调用原数组方法方法\n    let inserted;\n    // 如果是给数组中新增数据，我们需要对新增的数据响应数据处理（如果是对象的话）\n    switch (method) {\n      case \"push\":\n      case \"unshift\":\n        // 新增的数据就是当前方法的参数\n        inserted = args;\n        break;\n      case \"splice\": // splice也可以新增\n        inserted = args.slice(2); // 如果有第三个参数 证明是新增，第三个参数就是新增的那一项\n        break;\n      default:\n        break;\n    }\n    // 将新增的数据变为可观测\n    inserted && ob.observeArray(inserted);\n    return result;\n  };\n});\n","import { isObject } from \"../utils\";\nimport { arrayMethods } from \"./array\";\n\nclass Observer {\n  constructor(data) {\n    // 将当前实例挂载到data上 __ob__也可以作为一个响应式的标识\n    Object.defineProperty(data, \"__ob__\", {\n      enumerable: false, // 为了避免死循环，重复的枚举当前实例，使当前属性不可枚举\n      configurable: false, // 同样也不想这个属性被修改所以也不可配置\n      value: this,\n    });\n    // 判断一下是不是数组类型，如果是数组走函数劫持的方法\n    if (Array.isArray(data)) {\n      data.__proto__ = arrayMethods;\n      this.observeArray(data);\n    } else {\n      this.walk(data);\n    }\n  }\n  // [{a:111}] 需要将这种类型的数据也进行响应观测\n  observeArray(data) {\n    for (let key in data) {\n      observe(data[key]);\n    }\n  }\n  walk(data) {\n    Object.keys(data).forEach((key) => {\n      defineReactive(data, key, data[key]);\n    });\n  }\n}\n\nfunction defineReactive(data, key, value) {\n  observe(value);\n  Object.defineProperty(data, key, {\n    get() {\n      return value;\n    },\n    set(newVal) {\n      if (newVal == value) return;\n      observe(newVal); // 监控当前设置的值 因为设置的值也可能是个对象\n      value = newVal;\n    },\n  });\n}\n\nexport function observe(data) {\n  // 如果不是对象就返回\n  if (!isObject(data)) {\n    return;\n  }\n\n  // 防止对象被重复观测\n  if (data.__ob__ instanceof Observer) {\n    return;\n  }\n  return new Observer(data);\n}\n","import { observe } from \"./obsever/index\";\n\nexport function initState(vm) {\n  const opts = vm.$options;\n  if (opts.props) {\n    initProps(vm);\n  }\n  if (opts.methods) {\n    initMethods(vm);\n  }\n  if (opts.data) {\n    initData(vm);\n  }\n}\n\nfunction initProps() {}\n\nfunction initMethods() {}\n\nfunction proxy(target, property, key) {\n  Object.defineProperty(target, key, {\n    get() {\n      return target[property][key];\n    },\n    set(newValue) {\n      target[property][key] = newValue;\n    },\n  });\n}\n\nfunction initData(vm) {\n  console.log(vm.$options.data);\n  // 数据响应式原理\n  let data = vm.$options.data;\n  data = vm._data = typeof data === \"function\" ? data.call(vm) : data;\n  for (let key in data) {\n    proxy(vm, \"_data\", key);\n  }\n  observe(data);\n}\n","// 一堆正则\n//               字母大小写_  -.数字字母大小写 任意多个\nconst ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*`; // 标签名\n// ?:匹配但不捕获 <aaa:aaa>\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`; // 匹配标签名\nconst startTagOpen = new RegExp(`^<${qnameCapture}`); // 标签开头的正则 捕获的内容是标签名\nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`); // 匹配标签结尾的 </div>\n// 捕获到的是属性名和属性值 属性值可以是双引号/单引号/无引号 包裹\nconst attribute = /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/; // 匹配属性的\nconst startTagClose = /^\\s*(\\/?)>/; // 匹配标签结束的 >\n\nexport function parserHTML(html) {\n  let root; // 根元素\n  let stack = []; // 用于记录元素的栈\n  let currentParent; // 记录当前元素\n  // 用于创建元素对象\n  function createASTElement(tagName, attrs) {\n    return {\n      tag: tagName,\n      attrs,\n      children: [],\n      parent: null,\n      type: 1, // nodetype 元素是1，文本是3\n    };\n  }\n  /**\n   * desc 用于解析标签结构的一种方式 栈型结构解析\n   * 以 <div id=\"app\" style=\"color: red\"><span>hello world {{msg}}</span></div> 为例\n   * 解析到div 将div放入栈中 [div]\n   * 继续解析，解析到span将span放入栈中 [div,span]\n   * 继续解析，解析到span的结尾标签，则将span出栈，[div]，这时就可以确定，span是div的子元素，div是span的父元素\n   * 同样的道理，如果解析的过程中遇到了未闭合的标签就可以抛出错误\n   *\n   */\n  // 处理开始标签\n  function start(tagName, attrs) {\n    let element = createASTElement(tagName, attrs);\n    // 将第一个元素赋值为根元素\n    if (!root) {\n      root = element;\n    }\n    currentParent = element;\n    stack.push(element);\n  }\n  // 处理结束标签\n  function end(tagName) {\n    // 解析到结尾标签的时候，将当前栈中的最后一个元素出栈\n    let element = stack.pop();\n    // 判断当前出栈元素是否跟当前结尾标签相同，如果不相同则抛出错误\n    if (element.tag !== tagName) {\n      throw new Error(`${element.tag} 标签未闭合`);\n    }\n    let parent = stack[stack.length - 1];\n    if (parent) {\n      // 孩子可以有多个，但是爹只能有一个\n      element.parent = parent;\n      parent.children.push(element);\n    }\n  }\n  // 处理文本\n  function chars(text) {\n    // 将文本中的空格都删掉\n    text = text.replace(/\\s/g, \"\");\n    if (text) {\n      currentParent.children.push({\n        text,\n        type: 3,\n      });\n    }\n  }\n  // 循环解析\n  while (html) {\n    let textEnd = html.indexOf(\"<\");\n    // 如果是开头标签如<span  或者是结束标签如 </span>\n    if (textEnd === 0) {\n      // 匹配开始标签\n      const startTagMatch = parseStartTag();\n      if (startTagMatch) {\n        start(startTagMatch.tagName, startTagMatch.attrs);\n      }\n      // 匹配结束标签\n      const endTagMatch = html.match(endTag);\n      if (endTagMatch) {\n        // 如果匹配到结束标签就截掉结束标签\n        advance(endTagMatch[0].length);\n        end(endTagMatch[1]);\n      }\n    }\n    // 说明前面已经没有了开始标签，可能是这样的情况了 （hello world {{msg}}</span></div>） 这时的textEnd匹配的是</span>中的<\n    let text; // 这时候应该截取这段文本\n    if (textEnd > 0) {\n      text = html.substring(0, textEnd);\n    }\n    // 如果匹配到文本将文本截掉\n    if (text) {\n      advance(text.length);\n      chars(text);\n    }\n  }\n  // 解析前进（截掉已解析的字符串）\n  function advance(n) {\n    html = html.substring(n);\n  }\n  // 转换开始标签\n  function parseStartTag() {\n    // 获取开始标签\n    const start = html.match(startTagOpen);\n    // 如果匹配到了 就将匹配到的开始标签赋值\n    if (start) {\n      const match = {\n        tagName: start[1],\n        attrs: [],\n      };\n      // 将匹配到的部分删掉\n      advance(start[0].length);\n      let attr, end;\n      // 循环所有的属性 直到开始标签的结束 >\n      while (\n        !(end = html.match(startTagClose)) &&\n        (attr = html.match(attribute))\n      ) {\n        // 将匹配到的属性截取\n        advance(attr[0].length);\n        // 将属性push到match对象中\n        match.attrs.push({\n          name: attr[1],\n          // 分别代表双引号、单引号、无引号的情况\n          value: attr[3] || attr[4] || attr[5],\n        });\n      }\n      // 如果匹配到结束了那么删除结束的> 开始标签匹配结束\n      if (end) {\n        advance(end[0].length);\n        return match;\n      }\n    }\n  }\n  return root;\n}\n","// +？非贪婪模式 （尽可能的少取）\nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g; // 匹配双花括号的\n// 将属性拼接成字符串\nfunction genProps(attrs) {\n  let str = \"\";\n  for (let i = 0; i < attrs.length; i++) {\n    let attr = attrs[i];\n    if (attr.name === \"style\") {\n      let obj = {};\n      let styles = attr.value.split(\";\").forEach((item) => {\n        let [key, value] = item.split(\":\");\n        obj[key] = value;\n      });\n      attr.value = obj;\n    }\n    str += `${attr.name}:${JSON.stringify(attr.value)},`;\n  }\n  return `{${str.slice(0, -1)}}`;\n}\n\n// 编译每一个child\nfunction gen(node) {\n  // 如果当前的节点是元素 那么就递归循环\n  if (node.type === 1) {\n    return generate(node);\n  } else {\n    // 如果是文本的话 需要处理将变量和普通文本区分出来\n    let text = node.text;\n    // 如果没有变量则直接返回\n    if (!defaultTagRE.test(text)) {\n      return `_v(${JSON.stringify(text)})`;\n    } else {\n      let tokens = []; // 用于放截取出来的字符串\n      let lastIndex = (defaultTagRE.lastIndex = 0); // 正则的lastIndex 修正test过后的变化 置为0\n      let match, index;\n      while ((match = defaultTagRE.exec(text))) {\n        index = match.index; // 当前这次匹配的第一个位置\n        // 当前匹配的位置>上次匹配的结尾 说明当前这一次匹配的位置和上次匹配的位置中间有普通文本，将文本push到tokens中\n        if (index > lastIndex) {\n          tokens.push(JSON.stringify(text.slice(lastIndex, index)));\n        }\n        // 将匹配到的变量用_s()包裹起来\n        tokens.push(`_s(${match[1].trim()})`);\n        console.log(lastIndex);\n        // 将lastIndex修改为匹配到的位置结尾处\n        lastIndex = index + match[0].length;\n      }\n      // 都匹配完了 结尾可能还有一部分 如 helloworld {{msg}}  aa 其中的aa也需要push进去\n      tokens.push(JSON.stringify(text.slice(lastIndex)));\n      return `_v(${tokens.join(\"+\")})`;\n    }\n  }\n}\n// 编译children\nfunction genChildren(el) {\n  const children = el.children;\n  if (children) {\n    return children.map((c) => gen(c)).join(\",\");\n  } else {\n    return false;\n  }\n}\nexport function generate(el) {\n  let children = genChildren(el);\n  let code = `_c(\"${el.tag}\",${\n    el.attrs.length ? genProps(el.attrs) : \"undefined\"\n  }${children ? `,${children}` : \"\"})`;\n  return code;\n}\n","import { parserHTML } from \"./parser\";\nimport { generate } from \"./generate\";\n\nexport function compileToFunctions(template) {\n  console.log(template);\n  // 第一步 由模板编译成ast语法树\n  let ast = parserHTML(template);\n  console.log(ast);\n  /**\n   * 第二步将ast语法树解析成render函数\n   * {\n   *   tag：‘div’,\n   *   attrs:[{name: \"id\", value: \"app\"},{name: \"style\", value: \"color: red\"}],\n   *   children:[{\n   *     tag:'span',\n   *     parent: {tag: \"div\", attrs: Array(2), children: Array(1), parent: null, type: 1},\n   *     children:[{type: 3,text: \"helloworld{{msg}}\"}],\n   *     type:1,\n   *     attrs:[]\n   *   }],\n   *   type:1\n   *   parent: null\n   * }\n   * 转化成\n   * render(){\n   *   return _c('div',{style:{color:'red'}},_v('hello'+_s(name)),_c('span',undefined,''))\n   * }\n   */\n  let code = generate(ast);\n  code = `with(this){return ${code}}`;\n  console.log(code);\n\n  let render = new Function(code); // 将字符串转换为函数\n  return render;\n}\n","class Watcher {\n  constructor(vm, exprOrFn, cb, options) {\n    exprOrFn();\n  }\n}\n\nexport default Watcher;\n","import Watcher from \"./obsever/watcher\";\n\nexport function lifeCycleMixin(Vue) {\n  Vue.prototype._update = function () {\n    console.log(\"_update\");\n  };\n}\n\nexport function mountComponent(vm, el) {\n  // Vue在渲染过程中会创建一个“渲染watcher”，只用来渲染\n  // watcher就相当于是一个回调，每次数据变化，就会重新执行watcher\n\n  const updateComponent = () => {\n    // _render内部会调用 解析后的render方法  => 返回的是vnode（虚拟节点）\n    // _update将虚拟节点转换为dom节点\n    vm._update(vm._render());\n  };\n  // 每次数据变化 就执行updateComponent 方法进行更新操作\n  new Watcher(vm, updateComponent, () => {}, true);\n}\n","import { initState } from \"./state\";\nimport { compileToFunctions } from \"./compiler/index\";\nimport { mountComponent } from \"./lifecycle\";\n\nexport function initMixin(Vue) {\n  Vue.prototype._init = function (options) {\n    const vm = this;\n    vm.$options = options;\n\n    initState(vm);\n\n    // 通过模板渲染\n    if (vm.$options.el) {\n      vm.$mount(vm.$options.el);\n    }\n    // 走到这里就是不需要编译模板了 或者已经编译完了\n  };\n  Vue.prototype.$mount = function (el) {\n    const vm = this;\n    const options = vm.$options;\n    el = document.querySelector(el);\n    // 如果用户没有传render方法，那么就需要将template转换成render方法\n    if (!options.render) {\n      let template = vm.$options.template;\n      // 如果用户也没有传template，那么就将el作为模板转换成render函数\n      if (!template && el) {\n        template = el.outerHTML;\n      }\n      const render = compileToFunctions(template);\n      options.render = render;\n      console.log(options.render);\n    }\n    // 组件的挂在流程\n    mountComponent(vm, el);\n  };\n}\n","export function createTextVnode(text) {\n  return vnode(undefined, undefined, undefined, undefined, text);\n}\n\nexport function createElement(tag, data = {}, ...children) {\n  // let key = data.key;\n  // if (key) {\n  //   delete data.key;\n  // }\n  return vnode(tag, data, data.key, children);\n}\n\nfunction vnode(tag, data, key, children, text) {\n  return {\n    tag,\n    data,\n    key,\n    children,\n    text,\n  };\n}\n","import { createTextVnode, createElement } from \"./vdom/create-element\";\n\nexport function renderMixin(Vue) {\n  Vue.prototype._render = function () {\n    console.log(\"_render\");\n    const vm = this;\n    const { render } = vm.$options;\n    // 创建文本的虚拟节点\n    Vue.prototype._v = function (text) {\n      return createTextVnode(text);\n    };\n    // 创建元素虚拟节点\n    Vue.prototype._c = function () {\n      return createElement(...arguments);\n    };\n    // 值\n    Vue.prototype._s = function (val) {\n      return val == null\n        ? \"\"\n        : typeof val === \"object\"\n        ? JSON.stringify(val)\n        : val;\n    };\n    const vnode = render.call(this);\n    console.log(vnode);\n    return vnode;\n  };\n}\n","import { initMixin } from \"./init\";\nimport { renderMixin } from \"./render\";\nimport { lifeCycleMixin } from \"./lifecycle\";\nfunction Vue(options) {\n  this._init(options);\n}\n\ninitMixin(Vue); // 添加原型方法\nrenderMixin(Vue);\nlifeCycleMixin(Vue);\nexport default Vue;\n"],"names":["isObject","obj","oldArrayMethods","Array","prototype","arrayMethods","Object","create","methods","forEach","method","ob","__ob__","args","result","apply","inserted","slice","observeArray","Observer","data","defineProperty","enumerable","configurable","value","isArray","__proto__","walk","key","observe","keys","defineReactive","get","set","newVal","initState","vm","opts","$options","props","initData","proxy","target","property","newValue","console","log","_data","call","ncname","qnameCapture","startTagOpen","RegExp","endTag","attribute","startTagClose","parserHTML","html","root","stack","currentParent","createASTElement","tagName","attrs","tag","children","parent","type","start","element","push","end","pop","Error","length","chars","text","replace","textEnd","indexOf","startTagMatch","parseStartTag","endTagMatch","match","advance","substring","n","attr","name","defaultTagRE","genProps","str","i","styles","split","item","JSON","stringify","gen","node","generate","test","tokens","lastIndex","index","exec","trim","join","genChildren","el","map","c","code","compileToFunctions","template","ast","render","Function","Watcher","exprOrFn","cb","options","lifeCycleMixin","Vue","_update","mountComponent","updateComponent","_render","initMixin","_init","$mount","document","querySelector","outerHTML","createTextVnode","vnode","undefined","createElement","renderMixin","_v","_c","arguments","_s","val"],"mappings":"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"}