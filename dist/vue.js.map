{"version":3,"file":"vue.js","sources":["../src/utils.js","../src/obsever/array.js","../src/obsever/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["// 工具方法\nexport function isObject(obj) {\n  return typeof obj === \"object\" && obj !== null;\n}\n","let oldArrayMethods = Array.prototype;\n\nexport let arrayMethods = Object.create(oldArrayMethods);\n\nconst methods = [\"push\", \"shift\", \"unshift\", \"sort\", \"reverse\", \"splice\"];\nmethods.forEach((method) => {\n  arrayMethods[method] = function (...args) {\n    // 获取到当前调用方法上的ob\n    const ob = this.__ob__;\n    // 这里的this指向的是调用函数劫持后修改的数组 也就是调用arrMethods[method]的数组\n    const result = oldArrayMethods[method].apply(this, args); // 调用原数组方法方法\n    let inserted;\n    // 如果是给数组中新增数据，我们需要对新增的数据响应数据处理（如果是对象的话）\n    switch (method) {\n      case \"push\":\n      case \"unshift\":\n        // 新增的数据就是当前方法的参数\n        inserted = args;\n        break;\n      case \"splice\": // splice也可以新增\n        inserted = args.slice(2); // 如果有第三个参数 证明是新增，第三个参数就是新增的那一项\n        break;\n      default:\n        break;\n    }\n    // 将新增的数据变为可观测\n    inserted && ob.observeArray(inserted);\n    return result;\n  };\n});\n","import { isObject } from \"../utils\";\nimport { arrayMethods } from \"./array\";\n\nclass Observer {\n  constructor(data) {\n    // 将当前实例挂载到data上 __ob__也可以作为一个响应式的标识\n    Object.defineProperty(data, \"__ob__\", {\n      enumerable: false, // 为了避免死循环，重复的枚举当前实例，使当前属性不可枚举\n      configurable: false, // 同样也不想这个属性被修改所以也不可配置\n      value: this,\n    });\n    // 判断一下是不是数组类型，如果是数组走函数劫持的方法\n    if (Array.isArray(data)) {\n      data.__proto__ = arrayMethods;\n      this.observeArray(data);\n    } else {\n      this.walk(data);\n    }\n  }\n  // [{a:111}] 需要将这种类型的数据也进行响应观测\n  observeArray(data) {\n    for (let key in data) {\n      observe(data[key]);\n    }\n  }\n  walk(data) {\n    Object.keys(data).forEach((key) => {\n      defineReactive(data, key, data[key]);\n    });\n  }\n}\n\nfunction defineReactive(data, key, value) {\n  observe(value);\n  Object.defineProperty(data, key, {\n    get() {\n      return value;\n    },\n    set(newVal) {\n      if (newVal == value) return;\n      observe(newVal); // 监控当前设置的值 因为设置的值也可能是个对象\n      value = newVal;\n    },\n  });\n}\n\nexport function observe(data) {\n  // 如果不是对象就返回\n  if (!isObject(data)) {\n    return;\n  }\n  return new Observer(data);\n}\n","import { observe } from \"./obsever/index\";\n\nexport function initState(vm) {\n  const opts = vm.$options;\n  if (opts.props) {\n    initProps(vm);\n  }\n  if (opts.methods) {\n    initMethods(vm);\n  }\n  if (opts.data) {\n    initData(vm);\n  }\n}\n\nfunction initProps() {}\n\nfunction initMethods() {}\n\nfunction initData(vm) {\n  console.log(vm.$options.data);\n  // 数据响应式原理\n  let data = vm.$options.data;\n  data = vm._data = typeof data === \"function\" ? data.call(vm) : data;\n  observe(data);\n}\n","import { initState } from \"./state\";\n\nexport function initMixin(Vue) {\n  Vue.prototype._init = function (options) {\n    const vm = this;\n    vm.$options = options;\n\n    initState(vm);\n  };\n}\n","import { initMixin } from \"./init\";\n\nfunction Vue(options) {\n  this._init(options);\n}\n\ninitMixin(Vue); // 添加原型方法\n\nexport default Vue;\n"],"names":["isObject","obj","oldArrayMethods","Array","prototype","arrayMethods","Object","create","methods","forEach","method","ob","__ob__","args","result","apply","inserted","slice","observeArray","Observer","data","defineProperty","enumerable","configurable","value","isArray","__proto__","walk","key","observe","keys","defineReactive","get","set","newVal","initState","vm","opts","$options","props","initData","console","log","_data","call","initMixin","Vue","_init","options"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAAA;EACO,SAASA,QAAT,CAAkBC,GAAlB,EAAuB;EAC5B,SAAO,QAAOA,GAAP,MAAe,QAAf,IAA2BA,GAAG,KAAK,IAA1C;EACD;;ECHD,IAAIC,eAAe,GAAGC,KAAK,CAACC,SAA5B;EAEO,IAAIC,YAAY,GAAGC,MAAM,CAACC,MAAP,CAAcL,eAAd,CAAnB;EAEP,IAAMM,OAAO,GAAG,CAAC,MAAD,EAAS,OAAT,EAAkB,SAAlB,EAA6B,MAA7B,EAAqC,SAArC,EAAgD,QAAhD,CAAhB;EACAA,OAAO,CAACC,OAAR,CAAgB,UAACC,MAAD,EAAY;EAC1BL,EAAAA,YAAY,CAACK,MAAD,CAAZ,GAAuB,YAAmB;EACxC;EACA,QAAMC,EAAE,GAAG,KAAKC,MAAhB,CAFwC;;EAAA,sCAANC,IAAM;EAANA,MAAAA,IAAM;EAAA;;EAIxC,QAAMC,MAAM,GAAGZ,eAAe,CAACQ,MAAD,CAAf,CAAwBK,KAAxB,CAA8B,IAA9B,EAAoCF,IAApC,CAAf,CAJwC;;EAKxC,QAAIG,QAAJ,CALwC;;EAOxC,YAAQN,MAAR;EACE,WAAK,MAAL;EACA,WAAK,SAAL;EACE;EACAM,QAAAA,QAAQ,GAAGH,IAAX;EACA;;EACF,WAAK,QAAL;EAAe;EACbG,QAAAA,QAAQ,GAAGH,IAAI,CAACI,KAAL,CAAW,CAAX,CAAX,CADF;;EAEE;EARJ,KAPwC;;;EAoBxCD,IAAAA,QAAQ,IAAIL,EAAE,CAACO,YAAH,CAAgBF,QAAhB,CAAZ;EACA,WAAOF,MAAP;EACD,GAtBD;EAuBD,CAxBD;;MCFMK;EACJ,oBAAYC,IAAZ,EAAkB;EAAA;;EAChB;EACAd,IAAAA,MAAM,CAACe,cAAP,CAAsBD,IAAtB,EAA4B,QAA5B,EAAsC;EACpCE,MAAAA,UAAU,EAAE,KADwB;EACjB;EACnBC,MAAAA,YAAY,EAAE,KAFsB;EAEf;EACrBC,MAAAA,KAAK,EAAE;EAH6B,KAAtC,EAFgB;;EAQhB,QAAIrB,KAAK,CAACsB,OAAN,CAAcL,IAAd,CAAJ,EAAyB;EACvBA,MAAAA,IAAI,CAACM,SAAL,GAAiBrB,YAAjB;EACA,WAAKa,YAAL,CAAkBE,IAAlB;EACD,KAHD,MAGO;EACL,WAAKO,IAAL,CAAUP,IAAV;EACD;EACF;;;;;mCAEYA,MAAM;EACjB,WAAK,IAAIQ,GAAT,IAAgBR,IAAhB,EAAsB;EACpBS,QAAAA,OAAO,CAACT,IAAI,CAACQ,GAAD,CAAL,CAAP;EACD;EACF;;;2BACIR,MAAM;EACTd,MAAAA,MAAM,CAACwB,IAAP,CAAYV,IAAZ,EAAkBX,OAAlB,CAA0B,UAACmB,GAAD,EAAS;EACjCG,QAAAA,cAAc,CAACX,IAAD,EAAOQ,GAAP,EAAYR,IAAI,CAACQ,GAAD,CAAhB,CAAd;EACD,OAFD;EAGD;;;;;;EAGH,SAASG,cAAT,CAAwBX,IAAxB,EAA8BQ,GAA9B,EAAmCJ,KAAnC,EAA0C;EACxCK,EAAAA,OAAO,CAACL,KAAD,CAAP;EACAlB,EAAAA,MAAM,CAACe,cAAP,CAAsBD,IAAtB,EAA4BQ,GAA5B,EAAiC;EAC/BI,IAAAA,GAD+B,iBACzB;EACJ,aAAOR,KAAP;EACD,KAH8B;EAI/BS,IAAAA,GAJ+B,eAI3BC,MAJ2B,EAInB;EACV,UAAIA,MAAM,IAAIV,KAAd,EAAqB;EACrBK,MAAAA,OAAO,CAACK,MAAD,CAAP,CAFU;;EAGVV,MAAAA,KAAK,GAAGU,MAAR;EACD;EAR8B,GAAjC;EAUD;;EAEM,SAASL,OAAT,CAAiBT,IAAjB,EAAuB;EAC5B;EACA,MAAI,CAACpB,QAAQ,CAACoB,IAAD,CAAb,EAAqB;EACnB;EACD;;EACD,SAAO,IAAID,QAAJ,CAAaC,IAAb,CAAP;EACD;;EClDM,SAASe,SAAT,CAAmBC,EAAnB,EAAuB;EAC5B,MAAMC,IAAI,GAAGD,EAAE,CAACE,QAAhB;;EACA,MAAID,IAAI,CAACE,KAAT,EAAgB;;EAGhB,MAAIF,IAAI,CAAC7B,OAAT,EAAkB;;EAGlB,MAAI6B,IAAI,CAACjB,IAAT,EAAe;EACboB,IAAAA,QAAQ,CAACJ,EAAD,CAAR;EACD;EACF;;EAMD,SAASI,QAAT,CAAkBJ,EAAlB,EAAsB;EACpBK,EAAAA,OAAO,CAACC,GAAR,CAAYN,EAAE,CAACE,QAAH,CAAYlB,IAAxB,EADoB;;EAGpB,MAAIA,IAAI,GAAGgB,EAAE,CAACE,QAAH,CAAYlB,IAAvB;EACAA,EAAAA,IAAI,GAAGgB,EAAE,CAACO,KAAH,GAAW,OAAOvB,IAAP,KAAgB,UAAhB,GAA6BA,IAAI,CAACwB,IAAL,CAAUR,EAAV,CAA7B,GAA6ChB,IAA/D;EACAS,EAAAA,OAAO,CAACT,IAAD,CAAP;EACD;;ECvBM,SAASyB,SAAT,CAAmBC,GAAnB,EAAwB;EAC7BA,EAAAA,GAAG,CAAC1C,SAAJ,CAAc2C,KAAd,GAAsB,UAAUC,OAAV,EAAmB;EACvC,QAAMZ,EAAE,GAAG,IAAX;EACAA,IAAAA,EAAE,CAACE,QAAH,GAAcU,OAAd;EAEAb,IAAAA,SAAS,CAACC,EAAD,CAAT;EACD,GALD;EAMD;;ECPD,SAASU,GAAT,CAAaE,OAAb,EAAsB;EACpB,OAAKD,KAAL,CAAWC,OAAX;EACD;;EAEDH,SAAS,CAACC,GAAD,CAAT;;;;;;;;"}